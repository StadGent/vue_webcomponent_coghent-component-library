fragment minimalEntity on Entity {
  id
  object_id
  type
  title: metadata(key: [title]) {
    key
    value
  }
  description: metadata(key: [description]) {
    key
    value
  }
  primary_mediafile
  primary_mediafile_info {
    width
    height
  }
}

fragment touchTableEntity on Entity {
  id
  type
  title: metadata(key: [title]) {
    key
    value
  }
  description: metadata(key: [description]) {
    key
    value
  }
  primary_mediafile
  mediafiles {
    filename
  }
  relations {
    key
    type
    label
    value
  }
}

fragment fullBoxVisiter on BoxVisiter {
  id
  type
  code
  frames_seen_last_visit
  start_time
  touch_table_time
  relations{
      key
      type
      order
      label
      active
      last_frame
      seen_frames{
          id
          date
      }
  }
}

fragment fullStory on Entity {
  ...storyEntity
  relationMetadata {
    key
    audioFile
    subtitleFile
  }
  frames {
    ...storyEntity
    relationMetadata {
      ...assetMetadata
    }
    assets {
      ...storyEntity
      collections: metadata(key: [collection]) {
        key
        value
      }
    }
  }
}

fragment MetadataCollectionFields on MetadataCollection {
  label
  nested
  data {
    value
    unMappedKey
    label
    nestedMetaData {
      ...NestedEntity
      metadataCollection(
        key: [title, description, object_number, scopeNote]
        label: ["objectnummer"]
      ) {
        label
        nested
        data {
          value
          unMappedKey
          label
          nestedMetaData {
            ...nestedEndEntity
          }
        }
      }
    }
  }
}

fragment NestedEntity on Entity {
  id
  type
  title: metadata(key: [title]) {
    key
    value
  }
  description: metadata(key: [description]) {
    key
    value
  }
  objectNumber: metadata(key: [object_number]) {
    key
    value
  }
  mediafiles {
    _id
    original_file_location
    filename
  }
  relations {
    key
    type
    label
    value
  }
}

fragment nestedEndEntity on Entity {
  id
  type
  title: metadata(key: [title]) {
    key
    value
  }
  description: metadata(key: [description]) {
    key
    value
  }
  objectNumber: metadata(key: [object_number]) {
    key
    value
  }
  metadataCollection(
    key: [title, description, object_number, scopeNote]
    label: ["objectnummer"]
  ) {
    label
    nested
    data {
      value
      unMappedKey
      label
    }
  }
  mediafiles {
    _id
    original_file_location
    filename
  }
  relations {
    key
    type
    label
    value
  }
}

fragment fullEntity on Entity {
  id
  type
  title: metadata(key: [title]) {
    key
    value
  }
  scopeNote: metadata(key: [scopeNote]) {
    key
    value
  }
  description: metadata(key: [description]) {
    key
    value
  }
  objectNumber: metadata(key: [object_number]) {
    key
    value
  }
  metadataCollection(
    key: [title, description, object_number, scopeNote]
    label: []
  ) {
    ...MetadataCollectionFields
  }
  mediafiles {
    _id
    original_file_location
    filename
    metadata {
      key
      value
    }
  }
  relations {
    key
    type
    label
    value
  }
}

fragment creator on Entity {
  type
  metadata(key: [fullname, firstname, lastname, nationality]) {
    key
    value
  }
  relations {
    key
    type
    label
  }
}

fragment storyEntity on Entity {
  id
  type
  title: metadata(key: [title]) {
    key
    value
  }
  metadata(key: [description, collection]) {
    key
    value
  }
  mediafiles {
    original_file_location
    filename
    mediainfo {
      width
      height
    }
  }
  primary_mediafile_location
}

fragment fullUser on User {
  id
  email
  family_name
  given_name
  name
  preferred_username
}

fragment fullRelation on Relation {
  key
  type
  label
  value
  order
}

fragment boxRelation on Relation {
  key
  type
  active
  order
  last_frame
  seen_frames{
    id
    date
  }
}

fragment assetMetadata on Relation {
  key
  label
  timestamp_start
  timestamp_end
  timestamp_zoom
  position {
    x
    y
    z
  }
  scale
  audioFile
  subtitleFile
}

query getEntities($limit: Int, $skip: Int, $searchValue: SearchFilter!) {
  Entities(limit: $limit, skip: $skip, searchValue: $searchValue) {
    count
    limit
    results {
      ...minimalEntity
    }
    relations {
      ...fullRelation
    }
  }
}

query getFullEntities(
  $limit: Int
  $skip: Int
  $searchValue: SearchFilter!
  $fetchPolicy: String
) {
  Entities(
    limit: $limit
    skip: $skip
    searchValue: $searchValue
    fetchPolicy: $fetchPolicy
  ) {
    count
    limit
    results {
      ...fullEntity
    }
  }
}

query getEntityById($id: String!) {
  Entity(id: $id) {
    ...fullEntity
  }
}

query getTouchTableEntityById($id: String!) {
  Entity(id: $id) {
    ...touchTableEntity
  }
}

query getCreatorById($id: String!) {
  Entity(id: $id) {
    ...creator
  }
}

query getMe {
  User {
    ...fullUser
  }
}

query getRelations($searchValue: SearchFilter!) {
  Relations(searchValue: $searchValue) {
    count
    limit
    results {
      ...fullRelation
    }
  }
}

query getStories {
  Stories {
    count
    limit
    results {
      ...fullStory
    }
  }
}

query getEnumsByName($enumName: String!) {
  __type(name: $enumName) {
    name
    enumValues {
      name
    }
  }
}

query getActiveBox {
  ActiveBox{
   count
    limit
    results {
      ...fullStory
    }
  }
}

query getBoxVisiters{
    BoxVisiters{
        results {
            ...fullBoxVisiter
        },
        count
        limit
    }
}

query getBoxVisiterByCode($code: String!){
    BoxVisiterByCode(code: $code){
        ...fullBoxVisiter
    }
}

query getBoxVisiterRelationsByType($code: String!, $type: RelationType!){
    BoxVisiterRelationsByType(code: $code, type: $type){
        ...boxRelation
    }
}

query createBoxVisiter($storyId: String!){
    CreateBoxVisiter(storyId: $storyId){
        ...fullBoxVisiter
    }
}

mutation addStoryToBoxVisiter($code: String!, $story: StoryInput!){
    AddStoryToBoxVisiter(code: $code, story: $story){
        ...fullBoxVisiter
    }
}

mutation addFrameToStoryBoxVisiter($code: String!,$frameInput: FrameInput!){
    AddFrameToStoryBoxVisiter(code: $code, frameInput: $frameInput){
        ...fullBoxVisiter
    }
}

mutation addAssetToBoxVisiter($code: String!, $assetId: String!, $type: RelationType!){
    AddAssetToBoxVisiter(code: $code, assetId: $assetId, type: $type){
        key
        type
        label
        order
    }
}

query getTouchTableEntity($limit: Int, $searchValue: SearchFilter!) {
  Entities(limit: $limit, searchValue: $searchValue) {
    count
    limit
    results {
      ...touchTableEntity
    }
  }
}
